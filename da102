Basic & Intermediate SQL
    Week 2

    Combining two filter conditions using OR
-----------------------------------------------------

SELECT
	flight_number
	, airline
	, departure_city
	, arrival_city
	, revenue_from_baggage

FROM ba_flights 

WHERE 1=1
    AND departure_city = 'Aberdeen' -- flights leaving from or arrive at Aberdeen
	OR arrival_city = 'Aberdeen'
;


Combining an OR statement with a third condition
----------------------------------------------------

SELECT 
    flight_number
	, airline
	, departure_city
	, arrival_city

FROM ba_flights
-- we want any record that
-- is an aberdeen flight (coming or going)
-- AND has more than 10,000 baggage revenue
WHERE 1=1
    AND (departure_city = 'Aberdeen' 
			OR arrival_city = 'Aberbeen')
			AND revenue_from_baggage > 10000

    
Aggregating and Grouping Data using CASE WHEN
----------------------------------------------


SELECT
    client_id
    , SUM(revenue) AS total_revenue
    , SUM(conversions) AS total_conversions
    , SUM(conversions) / SUM(clicks) AS conversion_per_clicks
    , sum(revenue) / SUM(conversions) AS average_revenue_per_conversion
FROM meta_revenue
WHERE 1=1
    AND years = 2022
GROUP BY client_id
Limit 10
;


--Create a column called “ad_products” that creates one value that groups the Display ad types together and one value that groups the Video ad types together. 

--What is the total revenue generated by each ad product? 


SELECT * FROM meta_revenue

SELECT
    CASE 
        WHEN ad_types in ('Facebook Display', 'Instagram Display') THEN 'Display Ad'
        WHEN ad_types in ('Facebook Video', 'Instagram Video') THEN 'Video Ad'
        ELSE 'Other'
    END AS ad_products
    , SUM(revenue) AS total_revenue
FROM meta_revenue
GROUP BY ad_products
;

--Domestic activity is small compared to international activity - an insight you share with Humberto. He is surprised by these results, and asks you to dive deeper into the data to understand if there is a driving factor behind this.
--Question: 
--Analyze if there is a clear distinction in the sales of the LCS (Large Customer Sales) and SMB (Small and Medium Businesses) sales teams. Anything that doesn’t match LCS or SMB can be called Other.
--How much revenue did the LCS and SMB sales teams generate in 2022 split between domestic and international activity?

SELECT * FROM meta_revenue

SELECT
    CASE
        WHEN sales_team LIKE '%LCS%' THEN 'LCS'
        WHEN sales_team LIKE '%SMB%' THEN 'SMB'
        ELSE 'Other'
    END AS sales_segment
        , CASE
            WHEN geo_user = geo_advertiser THEN 'Domestic Activity'
            WHEN geo_user != geo_advertiser THEN 'International Activity'
            ELSE 'error'
        END AS geo_group
        , SUM(revenue) AS total_revenue
        
FROM meta_revenue
WHERE 1=1
    AND years = 2022
GROUP BY sales_segment
    , geo_group
ORDER BY sales_segment



    WEEK 3 

    UNION's 
    --------

    SELECT 
        CASE 
            WHEN product_name LIKE '%Vintage%' THEN 'Nike Vintage'
						ELSE 'Nike Official'
       END AS business_unit,
			 products.product_name,
			 (SUM(order_items.sale_price)-SUM(products.cost)) / SUM(order_items.sale_price) AS profit_margin

FROM order_items
		 LEFT JOIN products ON products.product_id = order_items.product_id
          
GROUP BY products.product_name

UNION ALL

SELECT CASE WHEN product_name LIKE '%Vintage%' THEN 'Nike Vintage'
						ELSE 'Nike Official'
       END AS business_unit,
			 products.product_name,
			 (SUM(order_items_vintage.sale_price)-SUM(products.cost)) / SUM(order_items_vintage.sale_price) AS profit_margin

FROM order_items_vintage
		 LEFT JOIN products ON products.product_id = order_items_vintage.product_id
          
GROUP BY products.product_name

ORDER BY profit_margin DESC

LIMIT 10
Expected Output (Truncated)



    
